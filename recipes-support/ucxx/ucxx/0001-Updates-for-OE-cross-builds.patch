From a575536e5019cf670c6fef9fa021265467f9d106 Mon Sep 17 00:00:00 2001
From: Ilies CHERGUI <ichergui@nvidia.com>
Date: Thu, 22 Jan 2026 09:17:38 -0800
Subject: [PATCH] Updates for OE cross builds

Upstream-Status: Inappropriate [OE-specific]
Signed-off-by: Ilies CHERGUI <ichergui@nvidia.com>
---
 cmake/rapids_config.cmake | 13 ++++++++++++-
 cpp/CMakeLists.txt        | 13 ++-----------
 2 files changed, 14 insertions(+), 12 deletions(-)

diff --git a/cmake/rapids_config.cmake b/cmake/rapids_config.cmake
index 0051673..99bd649 100644
--- a/cmake/rapids_config.cmake
+++ b/cmake/rapids_config.cmake
@@ -26,5 +26,16 @@ else()
   )
 endif()
 
+set(CPM_DOWNLOAD_VERSION 0.40.2)
+set(CPM_DOWNLOAD_LOCATION "${CPM_SOURCE_CACHE}/cpm/CPM_${CPM_DOWNLOAD_VERSION}.cmake")
+message(STATUS "CPM download location: ${CPM_DOWNLOAD_LOCATION}")
+
+if(NOT EXISTS "${RAPIDS_CMAKE_DIR}/RAPIDS.cmake")
+  message(FATAL_ERROR "Required RAPIDS.cmake does not exist!")
+endif()
+set(rapids-cmake_POPULATED "TRUE")
 set(rapids-cmake-version "${RAPIDS_VERSION_MAJOR_MINOR}")
-include("${CMAKE_CURRENT_LIST_DIR}/RAPIDS.cmake")
+list(APPEND CMAKE_MODULE_PATH "${RAPIDS_CMAKE_DIR}/rapids-cmake")
+
+set(rapids-cmake-dir "${RAPIDS_CMAKE_DIR}/rapids-cmake")
+include("${RAPIDS_CMAKE_DIR}/RAPIDS.cmake")
diff --git a/cpp/CMakeLists.txt b/cpp/CMakeLists.txt
index f0b659e..9361914 100644
--- a/cpp/CMakeLists.txt
+++ b/cpp/CMakeLists.txt
@@ -70,22 +70,13 @@ rapids_cmake_support_conda_env(conda_env MODIFY_PREFIX_PATH)
 
 # ##################################################################################################
 # * compiler options ------------------------------------------------------------------------------
-rapids_find_package(
-  ucx REQUIRED
-  GLOBAL_TARGETS ucx::ucp
-  BUILD_EXPORT_SET ucxx-exports
-  INSTALL_EXPORT_SET ucxx-exports
-)
+find_package(ucx 1.19.0 REQUIRED)
 
 # ##################################################################################################
 # * dependencies ----------------------------------------------------------------------------------
 
 # find Threads (needed by ucxxtestutil)
-rapids_find_package(
-  Threads REQUIRED
-  BUILD_EXPORT_SET ucxx-exports
-  INSTALL_EXPORT_SET ucxx-exports
-)
+find_package(Threads REQUIRED)
 
 # add third party dependencies using CPM
 rapids_cpm_init()
-- 
2.43.0

